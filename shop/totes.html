<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Totes - Tienda</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/vendor.css">
    <link rel="stylesheet" href="../style.css">
  </head>
  <body>
    <div class="shop-container">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <a href="../index.html" class="text-decoration-none">&larr; Volver</a>
        </div>
        <div>
          <a href="cart.html" class="btn btn-outline-primary me-2">Ver carrito <span class="cart-count">(0)</span></a>
          <span id="top-controls"></span>
        </div>
      </div>

      <header class="mb-4">
        <h1 class="display-5">Totes Clásicos</h1>
        <p class="text-muted">Selecciona un producto para añadir al carrito.</p>
      </header>

      <main>
        <div class="mb-3 text-center">
          <label class="me-2">Fondo de página (url):</label>
          <input id="bg-url" type="text" placeholder="https://..." class="form-control d-inline-block" style="width:380px;">
          <button id="set-bg" class="btn btn-sm btn-outline-secondary ms-2">Establecer fondo</button>
          <button id="clear-bg" class="btn btn-sm btn-outline-secondary ms-1">Borrar fondo</button>
        </div>

        <div class="products">
          <article class="product" data-id="tote-001" data-name="Tote Clásico Natural" data-price="12.50" data-image="../images/cat-item1.jpg">
            <div class="media" aria-hidden="true"></div>
            <div class="info">
              <h2>Tote Clásico Natural</h2>
              <p>Precio: $12.50</p>
              <div class="actions center">
                <button class="btn btn-primary add-to-cart">Añadir al carrito</button>
                <button class="btn btn-outline-secondary improve-bg">Mejorar fondo</button>
              </div>
            </div>
            <img src="../images/cat-item1.jpg" alt="tote clasico natural" style="display:none;">
          </article>

          <article class="product" data-id="tote-002" data-name="Tote Rayado" data-price="14.00" data-image="../images/banner-image-6.jpg">
            <div class="media" aria-hidden="true"></div>
            <div class="info">
              <h2>Tote Rayado</h2>
              <p>Precio: $14.00</p>
              <div class="actions center">
                <button class="btn btn-primary add-to-cart">Añadir producto</button>
                <button class="btn btn-outline-secondary improve-bg">Añadir fondo de inicio</button>
              </div>
            </div>
            <img src="../images/banner-image-6.jpg" alt="tote basico rayado" style="display:none;">
          </article>
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="../js/cart.js"></script>
    <script src="../js/theme.js"></script>
    <script>
      // Inicializar toggle e intentar añadir botón en 'top-controls'
      window.themeHelpers && window.themeHelpers.init({ insertToggle: '#top-controls' });

      // Recuperar fondo al cargar la página
      document.addEventListener('DOMContentLoaded', function() {
        const savedBg = localStorage.getItem('pageBackground');
        if (savedBg) {
          document.body.style.backgroundImage = `url('${savedBg}')`;
          document.body.style.backgroundSize = 'cover';
          document.body.style.backgroundRepeat = 'no-repeat';
        }
        // ajustar colores de texto basados en imágenes
        window.themeHelpers && window.themeHelpers.adaptImages();
      });

      // Guardar y establecer fondo
      document.getElementById('set-bg').addEventListener('click', function() {
        const url = document.getElementById('bg-url').value;
        if (url) {
          document.body.style.backgroundImage = `url('${url}')`;
          document.body.style.backgroundSize = 'cover';
          document.body.style.backgroundRepeat = 'no-repeat';
          localStorage.setItem('pageBackground', url);
        } else {
          alert('Por favor, ingresa una URL válida para el fondo.');
        }
      });

      document.getElementById('clear-bg').addEventListener('click', function(){
        localStorage.removeItem('pageBackground');
        document.body.style.backgroundImage = '';
      });

      // Add-to-cart behavior is handled by ../js/cart.js which exposes sdCart
      document.querySelectorAll('.add-to-cart').forEach(btn=>{
        btn.addEventListener('click', function(e){
          const article = e.target.closest('.product');
          const item = {
            id: article.dataset.id,
            name: article.dataset.name || (article.querySelector('h2') && article.querySelector('h2').textContent),
            price: Number(article.dataset.price||0),
            image: article.dataset.image || (article.querySelector('img') && article.querySelector('img').src),
            quantity: 1
          };
          if(window.sdCart && window.sdCart.add){ window.sdCart.add(item) } else {
            // fallback localStorage
            const existing = JSON.parse(localStorage.getItem('sd_cart')||'[]');
            existing.push(item); localStorage.setItem('sd_cart', JSON.stringify(existing));
          }
          alert('Producto añadido al carrito');
        })
      })
    </script>
  </body>
</html>