<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bolsos Estructurados - Tienda</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/vendor.css">
    <link rel="stylesheet" href="../style.css">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-light text-uppercase fs-6 p-3 border-bottom align-items-center">
      <div class="container-fluid">
        <a class="navbar-brand text-white" href="../index.html">Tienda</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Menú</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <ul class="navbar-nav justify-content-end flex-grow-1 gap-1 gap-md-5 pe-3">
              <li class="nav-item">
                <a class="nav-link active" href="../index.html">Inicio</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="cart.html">Carrito</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <main class="container mt-4">
      <h1 class="text-center mb-4">Bolsos Estructurados</h1>
      <div class="row">
        <div class="col-md-6 mb-4">
          <div class="card">
            <img src="../images/banner-image-2.jpg" class="card-img-top" alt="Bolso Grande">
            <div class="card-body">
              <h5 class="card-title">Bolso Estructurado Grande</h5>
              <p class="card-text">Precio: $25.00</p>
              <button class="btn btn-primary add-to-cart" data-id="bolso-001" data-name="Bolso Estructurado Grande" data-price="25.00">Añadir al carrito</button>
            </div>
          </div>
        </div>
        <div class="col-md-6 mb-4">
          <div class="card">
            <img src="../images/banner-image-2.jpg" class="card-img-top" alt="Bolso Mediano">
            <div class="card-body">
              <h5 class="card-title">Bolso Estructurado Mediano</h5>
              <p class="card-text">Precio: $20.00</p>
              <button class="btn btn-primary add-to-cart" data-id="bolso-002" data-name="Bolso Estructurado Mediano" data-price="20.00">Añadir al carrito</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoYF95z5y1HpUPRa9j7z9z74+7x1p1rV5z7fvepP5a1d5z" crossorigin="anonymous"></script>
    <script src="../js/cart.js"></script>
    <script>
      // El manejo de "añadir al carrito" lo realiza `js/cart.js` (clave `sd_cart`).
      // Si quieres personalizar el comportamiento aquí, usa la API global `sdCart`.

      // Ver carrito y generar formulario
      document.querySelector('.btn-common').addEventListener('click', function() {
        const cart = loadCart();
        if (cart.length === 0) {
          alert('El carrito está vacío.');
          return;
        }

        const formContainer = document.createElement('div');
        formContainer.style.maxWidth = '800px';
        formContainer.style.margin = '20px auto';
        formContainer.style.padding = '20px';
        formContainer.style.border = '1px solid #ddd';
        formContainer.style.borderRadius = '8px';
        formContainer.style.backgroundColor = '#f9f9f9';

        const form = document.createElement('form');
        form.id = 'checkout-form';

        const title = document.createElement('h3');
        title.textContent = 'Finalizar compra';
        title.style.textAlign = 'center';
        form.appendChild(title);

        cart.forEach(item => {
          const productRow = document.createElement('div');
          productRow.style.display = 'flex';
          productRow.style.justifyContent = 'space-between';
          productRow.style.marginBottom = '10px';

          const name = document.createElement('span');
          name.textContent = item.name;

          const price = document.createElement('span');
          price.textContent = `$${item.price.toFixed(2)}`;

          productRow.appendChild(name);
          productRow.appendChild(price);
          form.appendChild(productRow);
        });

        const total = cart.reduce((sum, item) => sum + item.price, 0);
        const totalRow = document.createElement('div');
        totalRow.style.textAlign = 'right';
        totalRow.style.fontWeight = 'bold';
        totalRow.textContent = `Total: $${total.toFixed(2)}`;
        form.appendChild(totalRow);

        const submitButton = document.createElement('button');
        submitButton.type = 'button';
        submitButton.textContent = 'Finalizar compra';
        submitButton.style.marginTop = '20px';
        submitButton.style.padding = '10px 20px';
        submitButton.style.backgroundColor = '#007bff';
        submitButton.style.color = '#fff';
        submitButton.style.border = 'none';
        submitButton.style.borderRadius = '4px';
        submitButton.style.cursor = 'pointer';

        submitButton.addEventListener('click', function() {
          generateInvoice(cart);
        });

        form.appendChild(submitButton);
        formContainer.appendChild(form);
        document.body.appendChild(formContainer);
      });

      // Generar factura en PDF
      function generateInvoice(cart) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        doc.setFontSize(18);
        doc.text('Factura / Pedido', 20, 20);

        let y = 40;
        cart.forEach(item => {
          doc.setFontSize(12);
          doc.text(`${item.name} - $${item.price.toFixed(2)}`, 20, y);
          y += 10;
        });

        const total = cart.reduce((sum, item) => sum + item.price, 0);
        doc.setFontSize(14);
        doc.text(`Total: $${total.toFixed(2)}`, 20, y + 10);

        doc.save('factura.pdf');
        alert('Factura generada y descargada.');
      }
    </script>
  </body>
</html>